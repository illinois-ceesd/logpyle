#! /usr/bin/env python


def main():
    import sys
    import argparse

    parser = argparse.ArgumentParser(description="Analyze a logpyle database.")
    parser.add_argument("-c", "--commands", action="store",
            help="commands to execute")
    parser.add_argument("dbfile", help="database file to read")
    parser.add_argument("scriptfile", nargs="?", help="script file to read")
    args = parser.parse_args()

    from logpyle.pandalyzer import (make_db, make_pandalyzer_symbols,
                                    PandalyzerConsole)

    if args.scriptfile:
        db = make_db(args.dbfile, interactive=False)
        exec(compile(open(args.scriptfile).read(), args.scriptfile, "exec"),
                make_pandalyzer_symbols(db))
    elif args.commands:
        db = make_db(args.dbfile, interactive=False)
        exec(compile(
            args.commands, "--commands", "exec"), make_pandalyzer_symbols(db))
    else:
        db = make_db(args.dbfile, interactive=True)
        cons = PandalyzerConsole(db)
        cons.interact("Pandalyzer running on Python "
                      + sys.version.split("\n")[0]
                      + "\nRun help() to see help for 'magic' commands.")


if __name__ == "__main__":
    main()
